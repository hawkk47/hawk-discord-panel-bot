<% const secondsToHms = (s) => { const h=Math.floor(s/3600), m=Math.floor((s%3600)/60), ss=s%60; return `${h}h ${m}m ${ss}s`; }; %>

<section class="mb-6">
  <h1 class="text-2xl font-semibold title">Tableau de bord</h1>
  <p class="text-sm text-gray-400 mt-2">Statut du bot, acc√®s rapide et serveurs g√©rables.</p>
</section>

<!-- Stats -->
<div class="grid md:grid-cols-3 gap-4">
  <div class="ui-card ui-card-lg hover-lift">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-xl grid place-items-center ring-1 ring-white/10" style="background:linear-gradient(135deg, rgba(99,102,241,.28), rgba(34,211,238,.18))">‚ö°</div>
      <div>
        <div class="text-sm text-gray-300/80">Latence</div>
        <div class="text-2xl font-semibold"><span id="tilePing"><%= ping ?? '‚Äî' %></span> ms</div>
      </div>
    </div>
  </div>
  <div class="ui-card ui-card-lg hover-lift">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-xl grid place-items-center ring-1 ring-white/10" style="background:linear-gradient(135deg, rgba(99,102,241,.28), rgba(34,211,238,.18))">‚è±Ô∏è</div>
      <div>
        <div class="text-sm text-gray-300/80">Uptime</div>
        <div class="text-2xl font-semibold"><span id="tileUptime"><%= secondsToHms(uptime) %></span></div>
      </div>
    </div>
  </div>
  <div class="ui-card ui-card-lg hover-lift">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-xl grid place-items-center ring-1 ring-white/10" style="background:linear-gradient(135deg, rgba(99,102,241,.28), rgba(34,211,238,.18))">üè∞</div>
      <div>
        <div class="text-sm text-gray-300/80">Guilds</div>
        <div class="text-2xl font-semibold" id="tileGuilds"><%= guildCount %></div>
      </div>
    </div>
  </div>
</div>

<!-- Actions -->
<div class="mt-4 flex flex-wrap items-center gap-2">
  <a href="<%= inviteUrl %>" class="ui-btn ui-btn--primary ripple">+ Ajouter le bot</a>
  <a href="/guilds" class="ui-btn ui-btn--ghost ripple">Voir les serveurs</a>
</div>

<!-- Guilds -->
<section class="mt-8">
  <div class="flex items-center justify-between mb-3">
    <h2 class="text-xl font-semibold title">Guilds accessibles</h2>
    <div class="ui-input-wrap w-72">
      <svg class="ui-input-icon" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
      <input id="search" type="text" placeholder="Rechercher..." class="ui-input" />
    </div>
  </div>

  <div id="guilds" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
    <% for (const g of manageable) { %>
      <a href="/guilds/<%= g.id %>" class="ui-card ui-card-lg hover-lift">
        <div class="flex items-center gap-3">
          <% if (g.icon) { %>
            <img src="https://cdn.discordapp.com/icons/<%= g.id %>/<%= g.icon %>.png?size=128" class="h-12 w-12 rounded-xl ring-1 ring-white/10">
          <% } else { %>
            <div class="h-12 w-12 rounded-xl ring-1 ring-white/10" style="background:rgba(255,255,255,.08)"></div>
          <% } %>
          <div>
            <div class="font-semibold"><%= g.name %></div>
            <div class="text-xs text-gray-400">ID: <%= g.id %></div>
          </div>
        </div>
      </a>
    <% } %>
  </div>
</section>

<!-- Logs & Configs -->
<div class="mt-8 grid lg:grid-cols-2 gap-6">
  <div class="ui-card ui-card-lg">
    <h3 class="font-semibold mb-3">√âv√©nements en direct</h3>
    <ul id="liveLog" class="space-y-2 max-h-72 overflow-auto text-sm"></ul>
  </div>

  <div class="ui-card ui-card-lg">
    <h3 class="font-semibold mb-2">Configs connues</h3>
    <p class="text-xs text-gray-400">(<%= (configs || []).length %> en base)</p>
    <ul class="mt-3 text-sm list-disc pl-5">
      <% for (const c of configs) { %>
        <li><code><%= c.guildId %></code> ‚Äî locale: <%= c.settings?.locale || 'fr' %>, purgeMax: <%= c.settings?.purgeLimitMax || 100 %></li>
      <% } %>
    </ul>
  </div>
</div>
